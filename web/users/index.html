<!-- users/index.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quan Ly Bot - Users</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<!-- Sidebar Navigation -->
<div class="sidebar">
    <div class="logo-details">
        <i class="bx bxl-c-plus-plus icon"></i>
        <div class="logo_name">Bot Manager</div>
        <i class="bx bx-menu" id="btn"></i>
    </div>
    <ul class="nav-list">
        <li>
            <i class="bx bx-search"></i>
            <input type="text" placeholder="Search..." />
            <span class="tooltip">Search</span>
        </li>
        <li>
            <a href="/home/">
                <i class="bx bx-grid-alt"></i>
                <span class="links_name">Home</span>
            </a>
            <span class="tooltip">Home</span>
        </li>
        <li>
            <a href="/manager/" data-require-login="true">
                <i class="bx bx-cog"></i>
                <span class="links_name">Manager</span>
            </a>
            <span class="tooltip">Manager</span>
        </li>
        <li>
            <a href="/bots/" data-require-login="true">
                <i class="bx bxs-bot"></i>
                <span class="links_name">Bot</span>
            </a>
            <span class="tooltip">Bot</span>
        </li>
        <li>
            <a href="/create/" data-require-login="true">
                <i class="bx bx-plus"></i>
                <span class="links_name">Create</span>
            </a>
            <span class="tooltip">Create</span>
        </li>
        <li>
            <a href="/rental/" data-require-login="true">
                <i class="bx bx-money"></i>
                <span class="links_name">Rental</span>
            </a>
            <span class="tooltip">Rental</span>
        </li>
        <li>
            <a href="/commands/" data-require-login="true">
                <i class="bx bx-command"></i>
                <span class="links_name">Commands</span>
            </a>
            <span class="tooltip">Commands</span>
        </li>
        <li>
            <a href="/statistics/" data-require-login="true">
                <i class="bx bx-pie-chart-alt-2"></i>
                <span class="links_name">Statistics</span>
            </a>
            <span class="tooltip">Statistics</span>
        </li>
        <li>
            <a href="/users/" data-require-login="true">
                <i class="bx bx-user"></i>
                <span class="links_name">Users</span>
            </a>
            <span class="tooltip">Users</span>
        </li>
        <li>
            <a href="/history/" data-require-login="true">
                <i class="bx bx-history"></i>
                <span class="links_name">History</span>
            </a>
            <span class="tooltip">History</span>
        </li>
        <li>
            <a href="/settings/" data-require-login="true">
                <i class="bx bx-slider"></i>
                <span class="links_name">Settings</span>
            </a>
            <span class="tooltip">Settings</span>
        </li>
        <li>
            <a href="/theme/" data-require-login="true">
                <i class="bx bx-palette"></i>
                <span class="links_name">Theme</span>
            </a>
            <span class="tooltip">Theme</span>
        </li>
        <li>
            <a href="#" id="theme-toggle-sidebar">
                <i class="bx bx-moon"></i>
                <span class="links_name">Theme</span>
            </a>
            <span class="tooltip">Toggle Theme</span>
        </li>
        <li id="auth-buttons" style="display: none;">
            <a href="/login/">
                <i class="bx bx-log-in"></i>
                <span class="links_name">Login</span>
            </a>
            <span class="tooltip">Login</span>
        </li>
        <li id="register-button" style="display: none;">
            <a href="/register/">
                <i class="bx bx-user-plus"></i>
                <span class="links_name">Register</span>
            </a>
            <span class="tooltip">Register</span>
        </li>
        <li class="profile" id="user-profile">
            <div class="profile-details">
                <img src="/profile.jpg" alt="profileImg" />
                <div class="name_job">
                    <div class="name" id="profile-name">User</div>
                    <div class="job">Web Manager</div>
                </div>
            </div>
            <i class="bx bx-log-out" id="logout-btn"></i>
        </li>
    </ul>
</div>

<section class="home-section">
    <div class="page active" id="users-page">
        <div class="users-container">
            <!-- Header -->
            <div class="users-header">
                <div class="header-left">
                    <h2 class="users-title">üë• Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h2>
                    <p class="users-subtitle">Qu·∫£n l√Ω ng∆∞·ªùi d√πng, admin v√† quy·ªÅn truy c·∫≠p bot</p>
                </div>
                <button class="btn-add-user" id="add-user-btn">
                    <i class="bx bx-plus"></i> Th√™m Ng∆∞·ªùi D√πng
                </button>
            </div>

            <!-- Stats Overview -->
            <div class="users-stats">
                <div class="stat-item">
                    <div class="stat-icon blue">
                        <i class="bx bx-user"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label">T·ªïng ng∆∞·ªùi d√πng</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon green">
                        <i class="bx bx-user-check"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="active-users">0</div>
                        <div class="stat-label">ƒêang ho·∫°t ƒë·ªông</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon orange">
                        <i class="bx bx-shield"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="admin-users">0</div>
                        <div class="stat-label">Admin</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon red">
                        <i class="bx bx-block"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="banned-users">0</div>
                        <div class="stat-label">B·ªã ch·∫∑n</div>
                    </div>
                </div>
            </div>

            <!-- Quick View Buttons -->
            <div class="quick-view-buttons">
                <button class="quick-view-btn" id="view-admins">
                    <i class="bx bx-shield"></i>
                    <span>Xem Admin</span>
                    <span class="quick-view-badge" id="quick-admin-count">0</span>
                </button>
                <button class="quick-view-btn" id="view-banned">
                    <i class="bx bx-block"></i>
                    <span>Xem B·ªã Ch·∫∑n</span>
                    <span class="quick-view-badge red" id="quick-banned-count">0</span>
                </button>
            </div>

            <!-- Filters -->
            <div class="users-filters">
                <div class="search-box">
                    <i class="bx bx-search"></i>
                    <input type="text" id="search-users" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng..." />
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">
                        <i class="bx bx-user"></i> T·∫•t c·∫£
                    </button>
                    <button class="filter-btn" data-filter="active">
                        <i class="bx bx-user-check"></i> Ho·∫°t ƒë·ªông
                    </button>
                    <button class="filter-btn" data-filter="admin">
                        <i class="bx bx-shield"></i> Admin
                    </button>
                    <button class="filter-btn" data-filter="banned">
                        <i class="bx bx-block"></i> B·ªã ch·∫∑n
                    </button>
                </div>
                <select class="sort-select" id="sort-users">
                    <option value="newest">M·ªõi nh·∫•t</option>
                    <option value="oldest">C≈© nh·∫•t</option>
                    <option value="name">T√™n A-Z</option>
                    <option value="messages">Tin nh·∫Øn nhi·ªÅu nh·∫•t</option>
                </select>
            </div>

            <!-- Users Grid -->
            <div class="users-grid" id="users-grid">
                <!-- Users will be loaded here -->
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <button class="page-btn" id="prev-page" disabled>
                    <i class="bx bx-chevron-left"></i> Tr∆∞·ªõc
                </button>
                <div class="page-numbers" id="page-numbers"></div>
                <button class="page-btn" id="next-page">
                    Sau <i class="bx bx-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</section>

<!-- User Detail Modal -->
<div class="modal" id="user-detail-modal">
    <div class="modal-content large">
        <span class="modal-close">&times;</span>
        <h3 class="modal-title">Chi Ti·∫øt Ng∆∞·ªùi D√πng</h3>
        
        <div class="user-detail" id="user-detail">
            <!-- User detail will be loaded here -->
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal" id="add-user-modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3 class="modal-title">Th√™m Ng∆∞·ªùi D√πng M·ªõi</h3>
        
        <div class="form-group">
            <label>Zalo ID</label>
            <input type="text" class="input-field" id="new-user-id" placeholder="0123456789" />
            <small style="color: #6b7280; font-size: 12px; margin-top: 5px; display: block;">Bot s·∫Ω t·ª± ƒë·ªông l·∫•y t√™n t·ª´ Zalo ID</small>
        </div>
        
        <div class="form-group">
            <label>Bot</label>
            <select class="input-field" id="new-user-bot">
                <option value="">-- Ch·ªçn bot --</option>
            </select>
        </div>
        
        <div class="form-group">
            <label style="display: block; margin-bottom: 10px; font-weight: 600;">Lo·∫°i Admin</label>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                    <input type="radio" name="admin-type" value="none" checked style="width: auto;" />
                    <span>Ng∆∞·ªùi d√πng th∆∞·ªùng</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                    <input type="radio" name="admin-type" value="admin" style="width: auto;" />
                    <span>Admin th∆∞·ªùng (vi·ªÅn cam)</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                    <input type="radio" name="admin-type" value="botadmin" style="width: auto;" />
                    <span>Admin Bot (vi·ªÅn v√†ng)</span>
                </label>
            </div>
        </div>
        
        <button class="btn btn-primary" id="submit-add-user">
            <i class="bx bx-plus"></i> Th√™m Ng∆∞·ªùi D√πng
        </button>
    </div>
</div>

<!-- Boxicons CDN Link -->
<link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
<script src="/sidebar.js"></script>

<style>
/* Users Container */
.users-container {
    padding: 30px;
    max-width: 1400px;
    margin: 0 auto;
}

/* Header */
.users-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
    gap: 20px;
}

.header-left {
    flex: 1;
}

.users-title {
    font-size: 32px;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 8px 0;
}

.users-subtitle {
    font-size: 16px;
    color: #6b7280;
    margin: 0;
}

.btn-add-user {
    padding: 12px 24px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-add-user:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

/* Stats Overview */
.users-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}

.stat-item {
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
}

.stat-icon.blue {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-icon.green {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.stat-icon.orange {
    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
}

.stat-icon.purple {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.stat-icon.red {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.stat-info {
    flex: 1;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #1f2937;
    line-height: 1;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 13px;
    color: #6b7280;
    font-weight: 600;
}

/* Quick View Buttons */
.quick-view-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
}

.quick-view-btn {
    flex: 1;
    padding: 15px 20px;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 15px;
    font-weight: 600;
    color: #374151;
}

.quick-view-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    border-color: #667eea;
}

.quick-view-btn i {
    font-size: 24px;
    color: #667eea;
}

.quick-view-badge {
    margin-left: auto;
    padding: 4px 12px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 700;
}

.quick-view-badge.red {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

/* Filters */
.users-filters {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.search-box {
    flex: 1;
    min-width: 250px;
    position: relative;
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 18px;
}

.search-box input {
    width: 100%;
    padding: 12px 15px 12px 45px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.3s ease;
}

.search-box input:focus {
    outline: none;
    border-color: #667eea;
}

.filter-buttons {
    display: flex;
    gap: 8px;
}

.filter-btn {
    padding: 10px 16px;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
    color: #6b7280;
}

.filter-btn:hover {
    border-color: #667eea;
    color: #667eea;
}

.filter-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: transparent;
}

.sort-select {
    padding: 10px 15px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    color: #374151;
}

.sort-select:focus {
    outline: none;
    border-color: #667eea;
}

/* Users Grid */
.users-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}

.user-card {
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
}

.user-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.user-card.premium {
    background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
    border-color: #f59e0b;
}

.user-card.premium::before {
    content: 'üëë';
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 24px;
}

.user-card.admin {
    background: linear-gradient(135deg, #fff5e6 0%, #ffffff 100%);
}

.user-card.botadmin {
    background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
}

.user-card.banned {
    opacity: 0.7;
    background: #fee2e2;
    border-color: #ef4444;
}

.user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    color: white;
    margin: 0 auto 15px;
    position: relative;
    box-shadow: 0 0 0 6px transparent;
    transition: all 0.3s ease;
}

.user-card.banned .user-avatar {
    box-shadow: 0 0 0 6px #ef4444;
}

.user-card.botadmin:not(.banned) .user-avatar[data-status="online"] {
    box-shadow: 0 0 0 6px #eab308;
}

.user-card.botadmin:not(.banned) .user-avatar[data-status="offline"] {
    box-shadow: 0 0 0 6px #9ca3af;
}

.user-card.admin:not(.banned):not(.botadmin) .user-avatar[data-status="online"] {
    box-shadow: 0 0 0 6px #f97316;
}

.user-card.admin:not(.banned):not(.botadmin) .user-avatar[data-status="offline"] {
    box-shadow: 0 0 0 6px #9ca3af;
}

.user-card:not(.banned):not(.admin):not(.botadmin) .user-avatar[data-status="online"] {
    box-shadow: 0 0 0 6px #10b981;
}

.user-card:not(.banned):not(.admin):not(.botadmin) .user-avatar[data-status="offline"] {
    box-shadow: 0 0 0 6px #9ca3af;
}

.user-status {
    display: none;
}

.user-name {
    font-size: 18px;
    font-weight: 700;
    color: #1f2937;
    text-align: center;
    margin-bottom: 5px;
}

.user-id {
    font-size: 12px;
    color: #9ca3af;
    text-align: center;
    margin-bottom: 15px;
    font-family: monospace;
}

.user-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 15px;
}

.user-stat {
    text-align: center;
}

.user-stat-value {
    font-size: 18px;
    font-weight: 700;
    color: #667eea;
}

.user-stat-label {
    font-size: 11px;
    color: #6b7280;
    font-weight: 600;
}

.user-actions {
    display: flex;
    gap: 8px;
}

.user-action-btn {
    flex: 1;
    padding: 8px;
    border: 2px solid #e5e7eb;
    background: white;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.user-action-btn:hover {
    border-color: #667eea;
    color: #667eea;
    background: #f0f4ff;
}

.user-action-btn.danger:hover {
    border-color: #ef4444;
    color: #ef4444;
    background: #fee2e2;
}

.user-action-btn.success:hover {
    border-color: #10b981;
    color: #10b981;
    background: #d1fae5;
}

.user-action-btn.admin-btn:hover {
    border-color: #8b5cf6;
    color: #8b5cf6;
    background: #ede9fe;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.page-btn {
    padding: 10px 16px;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
    color: #374151;
}

.page-btn:hover:not(:disabled) {
    border-color: #667eea;
    color: #667eea;
}

.page-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-numbers {
    display: flex;
    gap: 5px;
}

.page-num {
    width: 40px;
    height: 40px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #374151;
    background: white;
}

.page-num:hover {
    border-color: #667eea;
    color: #667eea;
}

.page-num.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: transparent;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 16px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
}

.modal-content.large {
    max-width: 700px;
}

.modal-close {
    position: absolute;
    right: 20px;
    top: 20px;
    font-size: 28px;
    font-weight: bold;
    color: #9ca3af;
    cursor: pointer;
    transition: color 0.3s ease;
}

.modal-close:hover {
    color: #ef4444;
}

.modal-title {
    font-size: 24px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
}

.input-field {
    width: 100%;
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

.input-field:focus {
    outline: none;
    border-color: #667eea;
}

.btn {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

/* User Detail */
.user-detail {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.detail-section {
    background: #f9fafb;
    padding: 20px;
    border-radius: 12px;
}

.detail-section h4 {
    font-size: 16px;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 15px 0;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #e5e7eb;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-label {
    font-size: 14px;
    color: #6b7280;
    font-weight: 600;
}

.detail-value {
    font-size: 14px;
    color: #1f2937;
    font-weight: 600;
}

/* Dark Mode */
body.dark .users-title {
    color: #f3f4f6;
}

body.dark .users-subtitle {
    color: #9ca3af;
}

body.dark .quick-view-btn {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
}

body.dark .quick-view-btn i {
    color: #818cf8;
}

body.dark .stat-item {
    background: #2d3748;
    border-color: #4b5563;
}

body.dark .stat-value {
    color: #f3f4f6;
}

body.dark .search-box input {
    background: #374151;
    border-color: #4b5563;
    color: #e5e7eb;
}

body.dark .filter-btn {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
}

body.dark .sort-select {
    background: #374151;
    border-color: #4b5563;
    color: #e5e7eb;
}

body.dark .user-card {
    background: #2d3748;
    border-color: #4b5563;
}

body.dark .user-card.admin {
    background: linear-gradient(135deg, #3b2f1f 0%, #2d3748 100%);
}

body.dark .user-card.botadmin {
    background: linear-gradient(135deg, #3b331f 0%, #2d3748 100%);
}

body.dark .user-name {
    color: #f3f4f6;
}

body.dark .user-action-btn {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
}

body.dark .page-btn,
body.dark .page-num {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
}

body.dark .modal-content {
    background: #2d3748;
}

body.dark .modal-title {
    color: #f3f4f6;
}

body.dark .form-group label {
    color: #f3f4f6;
}

body.dark .input-field {
    background: #374151;
    border-color: #4b5563;
    color: #e5e7eb;
}

body.dark .detail-section {
    background: #374151;
}

body.dark .detail-section h4 {
    color: #f3f4f6;
}

body.dark .detail-row {
    border-bottom-color: #4b5563;
}

body.dark .detail-label {
    color: #9ca3af;
}

body.dark .detail-value {
    color: #e5e7eb;
}

/* Responsive */
@media (max-width: 1200px) {
    .users-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .users-header {
        flex-direction: column;
    }
    
    .btn-add-user {
        width: 100%;
    }
    
    .users-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .users-filters {
        flex-direction: column;
    }
    
    .filter-buttons {
        flex-wrap: wrap;
    }
    
    .users-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
$(document).ready(function() {
    let currentPage = 1;
    let currentFilter = 'all';
    let currentSort = 'newest';
    let searchQuery = '';
    const usersPerPage = 9;
    
    // Sample users data
    const sampleUsers = [
        { id: '0987654321', name: 'Nguy·ªÖn VƒÉn A', avatar: 'üë§', status: 'online', messages: 1234, commands: 567, joinDate: '2024-01-15', admin: false, botAdmin: true, banned: false },
        { id: '0123456789', name: 'Tr·∫ßn Th·ªã B', avatar: 'üë©', status: 'online', messages: 987, commands: 432, joinDate: '2024-02-20', admin: true, botAdmin: false, banned: false },
        { id: '0912345678', name: 'L√™ VƒÉn C', avatar: 'üë®', status: 'offline', messages: 756, commands: 321, joinDate: '2024-03-10', admin: true, botAdmin: false, banned: false },
        { id: '0898765432', name: 'Ph·∫°m Th·ªã D', avatar: 'üëß', status: 'online', messages: 543, commands: 234, joinDate: '2024-03-25', admin: false, botAdmin: false, banned: false },
        { id: '0976543210', name: 'Ho√†ng VƒÉn E', avatar: 'üßë', status: 'offline', messages: 432, commands: 187, joinDate: '2024-04-05', admin: false, botAdmin: false, banned: false },
        { id: '0865432109', name: 'V≈© Th·ªã F', avatar: 'üë©', status: 'online', messages: 321, commands: 156, joinDate: '2024-04-15', admin: false, botAdmin: false, banned: false },
        { id: '0754321098', name: 'ƒê·ªó VƒÉn G', avatar: 'üë®', status: 'offline', messages: 210, commands: 98, joinDate: '2024-05-01', admin: false, botAdmin: false, banned: true },
        { id: '0643210987', name: 'B√πi Th·ªã H', avatar: 'üëß', status: 'online', messages: 156, commands: 67, joinDate: '2024-05-10', admin: false, botAdmin: false, banned: false },
        { id: '0532109876', name: 'ƒêinh VƒÉn I', avatar: 'üßë', status: 'online', messages: 98, commands: 45, joinDate: '2024-05-20', admin: false, botAdmin: false, banned: true }
    ];
    
    let allUsers = [...sampleUsers];
    
    // Check login
    function checkLogin() {
        $.ajax({
            url: '/api/auth/me',
            method: 'GET',
            error: function() {
                alert('‚ö†Ô∏è B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n l√Ω ng∆∞·ªùi d√πng!');
                window.location.href = '/login/';
            }
        });
    }
    
    // Load stats
    function loadStats() {
        const total = allUsers.length;
        const active = allUsers.filter(u => u.status === 'online' && !u.banned).length;
        const admins = allUsers.filter(u => u.admin || u.botAdmin).length;
        const banned = allUsers.filter(u => u.banned).length;
        
        $('#total-users').text(total);
        $('#active-users').text(active);
        $('#admin-users').text(admins);
        $('#banned-users').text(banned);
        $('#quick-admin-count').text(admins);
        $('#quick-banned-count').text(banned);
    }
    
    // Filter and sort users
    function getFilteredUsers() {
        let filtered = [...allUsers];
        
        // Apply filter
        if (currentFilter === 'active') {
            filtered = filtered.filter(u => u.status === 'online' && !u.banned);
        } else if (currentFilter === 'admin') {
            filtered = filtered.filter(u => u.admin || u.botAdmin);
        } else if (currentFilter === 'banned') {
            filtered = filtered.filter(u => u.banned);
        }
        
        // Apply search
        if (searchQuery) {
            filtered = filtered.filter(u => 
                u.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                u.id.includes(searchQuery)
            );
        }
        
        // Sort by admin priority first
        filtered.sort((a, b) => {
            // Bot Admin always first
            if (a.botAdmin && !b.botAdmin) return -1;
            if (!a.botAdmin && b.botAdmin) return 1;
            // Regular Admin second
            if (a.admin && !b.admin && !a.botAdmin && !b.botAdmin) return -1;
            if (!a.admin && b.admin && !a.botAdmin && !b.botAdmin) return 1;
            // Then apply user's selected sort
            if (currentSort === 'newest') {
                return new Date(b.joinDate) - new Date(a.joinDate);
            } else if (currentSort === 'oldest') {
                return new Date(a.joinDate) - new Date(b.joinDate);
            } else if (currentSort === 'name') {
                return a.name.localeCompare(b.name);
            } else if (currentSort === 'messages') {
                return b.messages - a.messages;
            }
            return 0;
        });
        
        return filtered;
    }
    
    // Render users
    function renderUsers() {
        const filtered = getFilteredUsers();
        const totalPages = Math.ceil(filtered.length / usersPerPage);
        const startIndex = (currentPage - 1) * usersPerPage;
        const endIndex = startIndex + usersPerPage;
        const pageUsers = filtered.slice(startIndex, endIndex);
        
        const $grid = $('#users-grid');
        $grid.empty();
        
        if (pageUsers.length === 0) {
            $grid.html(`
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #9ca3af;">
                    <div style="font-size: 60px; margin-bottom: 15px;">üë•</div>
                    <div style="font-size: 18px; font-weight: 600;">Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng</div>
                </div>
            `);
            return;
        }
        
        pageUsers.forEach(user => {
            const botAdminClass = user.botAdmin ? 'botadmin admin' : '';
            const adminClass = user.admin && !user.botAdmin ? 'admin' : '';
            const bannedClass = user.banned ? 'banned' : '';
            
            const card = $(`
                <div class="user-card ${botAdminClass} ${adminClass} ${bannedClass}" data-user-id="${user.id}">
                    <div class="user-avatar" data-status="${user.status}">
                        ${user.avatar}
                    </div>
                    <div class="user-name">${user.name}</div>
                    <div class="user-id">${user.id}</div>
                    <div class="user-stats">
                        <div class="user-stat">
                            <div class="user-stat-value">${user.messages}</div>
                            <div class="user-stat-label">Tin nh·∫Øn</div>
                        </div>
                        <div class="user-stat">
                            <div class="user-stat-value">${user.commands}</div>
                            <div class="user-stat-label">L·ªánh</div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="user-action-btn view-user" title="Xem chi ti·∫øt">
                            <i class="bx bx-show"></i>
                        </button>
                        <button class="user-action-btn admin-btn toggle-admin" title="Thay ƒë·ªïi quy·ªÅn">
                            <i class="bx bx-shield"></i>
                        </button>
                        <button class="user-action-btn ${user.banned ? 'success' : 'danger'} ban-user" title="${user.banned ? 'B·ªè ch·∫∑n' : 'Ch·∫∑n'}">
                            <i class="bx ${user.banned ? 'bx-check' : 'bx-block'}"></i>
                        </button>
                    </div>
                </div>
            `);
            
            $grid.append(card);
        });
        
        renderPagination(totalPages);
    }
    
    // Render pagination
    function renderPagination(totalPages) {
        const $numbers = $('#page-numbers');
        $numbers.empty();
        
        for (let i = 1; i <= totalPages; i++) {
            const activeClass = i === currentPage ? 'active' : '';
            const btn = $(`<div class="page-num ${activeClass}">${i}</div>`);
            btn.click(function() {
                currentPage = i;
                renderUsers();
            });
            $numbers.append(btn);
        }
        
        $('#prev-page').prop('disabled', currentPage === 1);
        $('#next-page').prop('disabled', currentPage === totalPages);
    }
    
    // View user detail
    $(document).on('click', '.view-user', function(e) {
        e.stopPropagation();
        const userId = $(this).closest('.user-card').data('user-id');
        const user = allUsers.find(u => u.id === userId);
        
        if (user) {
            const detail = `
                <div class="user-avatar" data-status="${user.status}" style="margin: 0 auto 20px;">
                    ${user.avatar}
                </div>
                <div class="user-name" style="text-align: center; margin-bottom: 20px;">
                    ${user.name} 
                    ${user.banned ? 'üî¥ B·ªã ch·∫∑n' : user.admin ? 'üõ°Ô∏è Admin' : ''}
                </div>
                
                <div class="detail-section">
                    <h4>üìã Th√¥ng Tin C∆° B·∫£n</h4>
                    <div class="detail-row">
                        <span class="detail-label">Zalo ID:</span>
                        <span class="detail-value">${user.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Tr·∫°ng th√°i:</span>
                        <span class="detail-value">${user.banned ? 'üî¥ B·ªã ch·∫∑n' : (user.status === 'online' ? 'üü¢ Online' : '‚ö´ Offline')}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ng√†y tham gia:</span>
                        <span class="detail-value">${new Date(user.joinDate).toLocaleDateString('vi-VN')}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Quy·ªÅn:</span>
                        <span class="detail-value">${user.admin ? 'üõ°Ô∏è Admin' : 'üë§ User'}</span>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4>üìä Th·ªëng K√™ Ho·∫°t ƒê·ªông</h4>
                    <div class="detail-row">
                        <span class="detail-label">Tin nh·∫Øn:</span>
                        <span class="detail-value">${user.messages.toLocaleString('vi-VN')}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">L·ªánh ƒë√£ d√πng:</span>
                        <span class="detail-value">${user.commands.toLocaleString('vi-VN')}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Trung b√¨nh/ng√†y:</span>
                        <span class="detail-value">${Math.round(user.messages / 30)}</span>
                    </div>
                </div>
            `;
            
            $('#user-detail').html(detail);
            $('#user-detail-modal').addClass('active');
        }
    });
    
    // Toggle admin
    $(document).on('click', '.toggle-admin', function(e) {
        e.stopPropagation();
        const userId = $(this).closest('.user-card').data('user-id');
        const user = allUsers.find(u => u.id === userId);
        
        if (user) {
            // Show selection dialog
            const options = ['Ng∆∞·ªùi d√πng th∆∞·ªùng', 'Admin th∆∞·ªùng', 'Admin Bot'];
            const current = user.botAdmin ? 2 : (user.admin ? 1 : 0);
            
            const choice = prompt(
                `Ch·ªçn quy·ªÅn cho ${user.name}:\n` +
                `0 = Ng∆∞·ªùi d√πng th∆∞·ªùng\n` +
                `1 = Admin th∆∞·ªùng (vi·ªÅn cam)\n` +
                `2 = Admin Bot (vi·ªÅn v√†ng)\n` +
                `\nHi·ªán t·∫°i: ${options[current]} (${current})\n` +
                `Nh·∫≠p s·ªë:`,
                current
            );
            
            if (choice === null) return;
            
            const newChoice = parseInt(choice);
            if (newChoice < 0 || newChoice > 2 || isNaN(newChoice)) {
                alert('‚ö†Ô∏è L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá!');
                return;
            }
            
            user.admin = newChoice === 1;
            user.botAdmin = newChoice === 2;
            
            renderUsers();
            loadStats();
            alert(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t quy·ªÅn th√†nh c√¥ng!`);
        }
    });
    
    // Ban/Unban user
    $(document).on('click', '.ban-user', function(e) {
        e.stopPropagation();
        const userId = $(this).closest('.user-card').data('user-id');
        const user = allUsers.find(u => u.id === userId);
        
        if (user) {
            const action = user.banned ? 'b·ªè ch·∫∑n' : 'ch·∫∑n';
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën ${action} ng∆∞·ªùi d√πng ${user.name}?`)) {
                user.banned = !user.banned;
                renderUsers();
                loadStats();
                alert(`‚úÖ ƒê√£ ${action} ng∆∞·ªùi d√πng th√†nh c√¥ng!`);
            }
        }
    });
    
    // Quick view buttons
    $('#view-admins').click(function() {
        $('.filter-btn').removeClass('active');
        $('.filter-btn[data-filter="admin"]').addClass('active');
        currentFilter = 'admin';
        currentPage = 1;
        renderUsers();
    });
    
    $('#view-banned').click(function() {
        $('.filter-btn').removeClass('active');
        $('.filter-btn[data-filter="banned"]').addClass('active');
        currentFilter = 'banned';
        currentPage = 1;
        renderUsers();
    });
    
    // Filter buttons
    $('.filter-btn').click(function() {
        $('.filter-btn').removeClass('active');
        $(this).addClass('active');
        currentFilter = $(this).data('filter');
        currentPage = 1;
        renderUsers();
    });
    
    // Sort select
    $('#sort-users').change(function() {
        currentSort = $(this).val();
        currentPage = 1;
        renderUsers();
    });
    
    // Search
    $('#search-users').on('input', function() {
        searchQuery = $(this).val();
        currentPage = 1;
        renderUsers();
    });
    
    // Pagination
    $('#prev-page').click(function() {
        if (currentPage > 1) {
            currentPage--;
            renderUsers();
        }
    });
    
    $('#next-page').click(function() {
        const totalPages = Math.ceil(getFilteredUsers().length / usersPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderUsers();
        }
    });
    
    // Add user modal
    $('#add-user-btn').click(function() {
        $('#add-user-modal').addClass('active');
    });
    
    // Submit add user
    $('#submit-add-user').click(function() {
        const userId = $('#new-user-id').val().trim();
        const botId = $('#new-user-bot').val();
        const adminType = $('input[name="admin-type"]:checked').val();
        
        if (!userId) {
            alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p Zalo ID!');
            return;
        }
        
        if (allUsers.find(u => u.id === userId)) {
            alert('‚ö†Ô∏è Zalo ID ƒë√£ t·ªìn t·∫°i!');
            return;
        }
        
        // Simulate getting name from Zalo API
        const randomNames = ['Nguy·ªÖn VƒÉn', 'Tr·∫ßn Th·ªã', 'L√™', 'Ph·∫°m', 'Ho√†ng', 'V≈©'];
        const randomName = randomNames[Math.floor(Math.random() * randomNames.length)] + ' ' + String.fromCharCode(65 + Math.floor(Math.random() * 26));
        
        const newUser = {
            id: userId,
            name: randomName, // Bot auto-fetched from Zalo
            avatar: 'üë§',
            status: 'offline',
            messages: 0,
            commands: 0,
            joinDate: new Date().toISOString().split('T')[0],
            admin: adminType === 'admin',
            botAdmin: adminType === 'botadmin',
            banned: false
        };
        
        allUsers.unshift(newUser);
        renderUsers();
        loadStats();
        
        $('#add-user-modal').removeClass('active');
        $('#new-user-id').val('');
        $('#new-user-bot').val('');
        $('input[name="admin-type"][value="none"]').prop('checked', true);
        
        const roleText = adminType === 'botadmin' ? ' (Admin Bot)' : (adminType === 'admin' ? ' (Admin)' : '');
        alert(`‚úÖ ƒê√£ th√™m ng∆∞·ªùi d√πng ${randomName}${roleText} th√†nh c√¥ng!`);
    });
    
    // Close modals
    $('.modal-close, .modal').click(function(e) {
        if (e.target === this) {
            $('.modal').removeClass('active');
        }
    });
    
    // Theme synchronization
    function applyTheme() {
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
            $('body').addClass('dark');
        } else {
            $('body').removeClass('dark');
        }
    }

    applyTheme();

    $('#theme-toggle-sidebar').click(function(e) {
        e.preventDefault();
        const currentTheme = localStorage.getItem('theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        localStorage.setItem('theme', newTheme);
        applyTheme();
    });

    $(window).on('storage', function(e) {
        if (e.originalEvent.key === 'theme') {
            applyTheme();
        }
    });
    
    // Initialize
    checkLogin();
    loadStats();
    renderUsers();
});
</script>
</body>
</html>